<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Weed Game with Character, Spliffs & Bong</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #222;
    color: #eee;
    margin: 0; padding: 0;
    overflow: hidden;
  }
  #game-container {
    display: flex;
    height: 100vh;
  }
  #game-canvas {
    background: #2a2a2a;
    display: block;
    margin: 0 auto;
    border: 2px solid #555;
    flex-grow: 1;
    position: relative;
    z-index: 1;
  }
  #ui-panel {
    width: 320px;
    background: #333;
    padding: 10px;
    box-sizing: border-box;
    overflow-y: auto;
  }
  button {
    background: #4a8cff;
    border: none;
    padding: 8px 12px;
    margin: 4px 0;
    color: white;
    font-weight: bold;
    cursor: pointer;
    border-radius: 4px;
  }
  button:disabled {
    background: #666;
    cursor: not-allowed;
  }
  h2, h3 {
    margin-top: 10px;
  }
  #messages {
    height: 80px;
    background: #222;
    margin: 8px 0;
    padding: 6px;
    font-size: 0.9em;
    overflow-y: auto;
    border: 1px solid #555;
    border-radius: 4px;
  }
  #laptop-ui, #roll-ui, #buy-ui, #customer-order-ui {
    background: #444;
    padding: 8px;
    margin-top: 10px;
    border-radius: 6px;
    display: none;
  }
  ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }
  ul li {
    margin-bottom: 5px;
  }
  ul li button {
    width: 100%;
    text-align: left;
  }
  label {
    display: block;
    margin-top: 6px;
  }
  input[type=range] {
    width: 100%;
  }
</style>
</head>
<body>
<div id="game-container">
  <canvas id="game-canvas" width="640" height="480"></canvas>
  <div id="ui-panel">
    <h2>Player Stats</h2>
    <div><strong>Money:</strong> $<span id="money">10000</span></div>
    <div><strong>Weed Stock:</strong> <span id="weed-stock">0.0</span> g</div>
    <div><strong>Spliffs:</strong> <span id="spliffs">0</span></div>
    <div><strong>Bong Weed:</strong> <span id="bong-weed">0.0</span> g</div>
    <button id="roll-spliff-btn">Roll Spliff</button>
    <button id="smoke-spliff-btn">Smoke Spliff</button>
    <hr />
    <button id="fill-bong-btn">Fill Bong with Weed (1g)</button>
    <button id="smoke-bong-btn">Smoke Bong</button>
    <hr />
    <button id="open-laptop-btn">Open Laptop</button>

    <div id="messages"></div>

    <!-- Rolling UI -->
    <div id="roll-ui">
      <h3>Roll a Spliff</h3>
      <label>Pack Amount: <span id="pack-amount-label">0%</span></label>
      <input type="range" id="pack-amount" min="0" max="100" value="0" />
      <label>Baccy Percentage: <span id="baccy-percent-label">0%</span></label>
      <input type="range" id="baccy-percent" min="0" max="100" value="0" />
      <button id="finish-roll-btn" disabled>Finish Rolling</button>
      <button id="cancel-roll-btn">Cancel</button>
    </div>

    <!-- Laptop UI -->
    <div id="laptop-ui">
      <h3>Laptop Contacts</h3>
      <strong>Dealers:</strong>
      <ul id="dealer-list"></ul>
      <strong>Customers:</strong>
      <ul id="customer-list"></ul>
      <button id="close-laptop-btn">Close Laptop</button>
    </div>

    <!-- Buy UI -->
    <div id="buy-ui">
      <h3 id="buy-ui-title">Buy Weed</h3>
      <p>Price per gram: $<span id="price-per-gram">10</span></p>
      <div>
        <button class="buy-amount-btn" data-amount="2">Buy 2g</button>
        <button class="buy-amount-btn" data-amount="5">Buy 5g</button>
        <button class="buy-amount-btn" data-amount="10">Buy 10g</button>
      </div>
      <button id="cancel-buy-btn">Cancel</button>
    </div>

    <!-- Customer Order UI -->
    <div id="customer-order-ui">
      <h3>Customer Order</h3>
      <p><span id="customer-name"></span> wants to buy <span id="customer-amount"></span>g of weed.</p>
      <button id="accept-order-btn">Accept Order</button>
      <button id="reject-order-btn">Reject Order</button>
      <button id="close-order-btn">Close</button>
    </div>
  </div>
</div>

<script>
(() => {
  // Canvas setup
  const canvas = document.getElementById("game-canvas");
  const ctx = canvas.getContext("2d");

  // UI elements
  const moneySpan = document.getElementById("money");
  const weedStockSpan = document.getElementById("weed-stock");
  const spliffsSpan = document.getElementById("spliffs");
  const bongWeedSpan = document.getElementById("bong-weed");

  const rollSpliffBtn = document.getElementById("roll-spliff-btn");
  const smokeSpliffBtn = document.getElementById("smoke-spliff-btn");
  const openLaptopBtn = document.getElementById("open-laptop-btn");

  const fillBongBtn = document.getElementById("fill-bong-btn");
  const smokeBongBtn = document.getElementById("smoke-bong-btn");

  const messagesDiv = document.getElementById("messages");

  // Roll UI
  const rollUI = document.getElementById("roll-ui");
  const packAmountInput = document.getElementById("pack-amount");
  const packAmountLabel = document.getElementById("pack-amount-label");
  const baccyPercentInput = document.getElementById("baccy-percent");
  const baccyPercentLabel = document.getElementById("baccy-percent-label");
  const finishRollBtn = document.getElementById("finish-roll-btn");
  const cancelRollBtn = document.getElementById("cancel-roll-btn");

  // Laptop UI
  const laptopUI = document.getElementById("laptop-ui");
  const dealerListEl = document.getElementById("dealer-list");
  const customerListEl = document.getElementById("customer-list");
  const closeLaptopBtn = document.getElementById("close-laptop-btn");

  // Buy UI
  const buyUI = document.getElementById("buy-ui");
  const pricePerGramSpan = document.getElementById("price-per-gram");
  const buyAmountBtns = buyUI.querySelectorAll(".buy-amount-btn");
  const cancelBuyBtn = document.getElementById("cancel-buy-btn");

  // Customer Order UI
  const customerOrderUI = document.getElementById("customer-order-ui");
  const customerNameSpan = document.getElementById("customer-name");
  const customerAmountSpan = document.getElementById("customer-amount");
  const acceptOrderBtn = document.getElementById("accept-order-btn");
  const rejectOrderBtn = document.getElementById("reject-order-btn");
  const closeOrderBtn = document.getElementById("close-order-btn");

  // Game state
  let money = 10000;
  let weedStock = 0;
  let spliffs = 0;
  let bongWeed = 0;

  // Player character state
  const player = {
    x: canvas.width / 2,
    y: canvas.height - 80,
    size: 40,
  };
  const playerState = {
    mode: "normal", // normal, rolling, smokingSpliff, smokingBong
    smokeTimer: 0,
    rollTimer: 0,
  };

  // Rolling spliff state
  let rolling = false;
  let packAmount = 0; // 0-100 percent
  let baccyPercent = 0; // 0-100 percent

  // Dealers and customers
  const dealers = [
    { name: "Zippy", phone: "555-WEED", pricePerGram: 10 },
    { name: "GreenJane", phone: "555-BUDS", pricePerGram: 12 },
    { name: "StickyRick", phone: "555-STICK", pricePerGram: 8 },
  ];

  const customers = [
    { name: "Mike", phone: "555-MIKE" },
    { name: "Anna", phone: "555-ANNA" },
    { name: "Jax", phone: "555-JAX" },
  ];

  // Messaging helper
  function showMessage(msg) {
    const p = document.createElement("div");
    p.textContent = msg;
    messagesDiv.appendChild(p);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  function updateUI() {
    moneySpan.textContent = money.toFixed(2);
    weedStockSpan.textContent = weedStock.toFixed(2);
    spliffsSpan.textContent = spliffs;
    bongWeedSpan.textContent = bongWeed.toFixed(2);

    // Buttons disable logic
    smokeSpliffBtn.disabled = spliffs <= 0 || playerState.mode !== "normal";
    rollSpliffBtn.disabled = rolling || playerState.mode !== "normal";
    fillBongBtn.disabled = weedStock < 1 || playerState.mode !== "normal";
    smokeBongBtn.disabled = bongWeed < 0.1 || playerState.mode !== "normal";
    openLaptopBtn.disabled = playerState.mode !== "normal";
  }

  // Draw player function
  function drawPlayer() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Body circle
    ctx.fillStyle = "#ffeeaa";
    ctx.beginPath();
    ctx.arc(player.x, player.y - player.size / 2, player.size / 2, 0, Math.PI * 2);
    ctx.fill();

    // Eyes
    const eyeY = player.y - player.size / 2 - 8;
    const eyeOffsetX = 10;
    ctx.fillStyle =
      playerState.mode === "smokingSpliff" || playerState.mode === "smokingBong"
        ? "red"
        : "black";

    // Left eye
    ctx.beginPath();
    ctx.ellipse(player.x - eyeOffsetX, eyeY, 5, 7, 0, 0, 2 * Math.PI);
    ctx.fill();

    // Right eye
    ctx.beginPath();
    ctx.ellipse(player.x + eyeOffsetX, eyeY, 5, 7, 0, 0, 2 * Math.PI);
    ctx.fill();

    // Rolling animation
    if (playerState.mode === "rolling") {
      const rollPhase = Math.sin(Date.now() / 200) * 10;
      ctx.fillStyle = "#ccaa55";
      // two rolling hands rectangles
      ctx.fillRect(player.x - 20 + rollPhase, player.y - player.size / 2, 14, 6);
      ctx.fillRect(player.x + 10 + rollPhase, player.y - player.size / 2, 14, 6);
    }

    // Bong smoking animation: show bong near mouth
    if (playerState.mode === "smokingBong") {
      ctx.fillStyle = "#4db8ff"; // blue bong
      ctx.fillRect(player.x + 15, player.y - player.size / 2 + 5, 12, 25);
      // bong bowl with smoke
      ctx.fillStyle = "#ccc";
      ctx.beginPath();
      ctx.arc(player.x + 21, player.y - player.size / 2 + 5, 8, 0, Math.PI * 2);
      ctx.fill();

      // Draw smoke (simple puffs)
      const puffCount = 6;
      for (let i = 0; i < puffCount; i++) {
        const x = player.x + 25 + Math.sin(Date.now() / 400 + i) * 6;
        const y = player.y - player.size / 2 - i * 12 - (Date.now() / 300) % 10;
        const alpha = 0.3 + 0.3 * Math.sin(Date.now() / 500 + i);
        ctx.fillStyle = `rgba(200,200,200,${alpha.toFixed(2)})`;
        ctx.beginPath();
        ctx.arc(x, y, 10 - i, 0, Math.PI * 2);
        ctx.fill();
      }
    }
  }

  // Smoke particles for spliff smoking
  let smokeParticles = [];
  let smokeActive = false;

  function startSmokeEffect() {
    smokeActive = true;
    smokeParticles = [];
    playerState.smokeTimer = 7000; // 7 seconds
    for (let i = 0; i < 50; i++) {
      smokeParticles.push({
        x: player.x,
        y: player.y - player.size / 2 - 10,
        size: Math.random() * 20 + 10,
        alpha: 1,
        speedX: (Math.random() - 0.5) * 1.5,
        speedY: -(Math.random() * 1 + 0.5),
      });
    }
    setTimeout(() => {
      smokeActive = false;
      playerState.mode = "normal";
      updateUI();
    }, 7000);
  }

  function drawSmoke() {
    if (!smokeActive) return;
    for (const p of smokeParticles) {
      ctx.fillStyle = `rgba(200,200,200,${p.alpha.toFixed(2)})`;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fill();

      // Update smoke particle
      p.x += p.speedX;
      p.y += p.speedY;
      p.alpha -= 0.005;
      if (p.alpha < 0) p.alpha = 0;
    }
    // Remove invisible particles
    smokeParticles = smokeParticles.filter((p) => p.alpha > 0);
  }

  // Rolling spliff UI and logic
  rollSpliffBtn.onclick = () => {
    if (playerState.mode !== "normal") return;
    rolling = true;
    packAmount = 0;
    baccyPercent = 0;
    rollUI.style.display = "block";
    finishRollBtn.disabled = true;
    packAmountInput.value = 0;
    packAmountLabel.textContent = "0%";
    baccyPercentInput.value = 0;
    baccyPercentLabel.textContent = "0%";
    playerState.mode = "rolling";
    updateUI();
  };

  packAmountInput.oninput = () => {
    packAmount = Number(packAmountInput.value);
    packAmountLabel.textContent = packAmount + "%";
    finishRollBtn.disabled = packAmount < 50; // Require at least 50% pack
  };
  baccyPercentInput.oninput = () => {
    baccyPercent = Number(baccyPercentInput.value);
    baccyPercentLabel.textContent = baccyPercent + "%";
  };

  finishRollBtn.onclick = () => {
    if (weedStock <= 0) {
      showMessage("No weed to roll a spliff!");
      return;
    }
    // Calculate weed needed for spliff (1g spliff max)
    const spliffWeight = (packAmount / 100) * 1; // max 1g spliff
    const weedNeeded = spliffWeight * (1 - baccyPercent / 100);
    if (weedNeeded > weedStock) {
      showMessage(`Not enough weed! Need ${weedNeeded.toFixed(2)}g.`);
      return;
    }
    weedStock -= weedNeeded;
    spliffs++;
    rolling = false;
    rollUI.style.display = "none";
    playerState.mode = "normal";
    showMessage(
      `Rolled a spliff: ${spliffWeight.toFixed(2)}g with ${baccyPercent}% baccy.`
    );
    updateUI();
  };

  cancelRollBtn.onclick = () => {
    rolling = false;
    rollUI.style.display = "none";
    playerState.mode = "normal";
    updateUI();
  };

  // Smoking spliff
  smokeSpliffBtn.onclick = () => {
    if (spliffs <= 0 || playerState.mode !== "normal") {
      showMessage("No spliffs to smoke!");
      return;
    }
    spliffs--;
    playerState.mode = "smokingSpliff";
    updateUI();
    showMessage("You smoke a spliff. Feel the chill...");
    startSmokeEffect();
  };

  // Bong logic
  fillBongBtn.onclick = () => {
    if (weedStock < 1) {
      showMessage("Not enough weed to fill the bong (need 1g).");
      return;
    }
    weedStock -= 1;
    bongWeed += 1;
    showMessage("Filled the bong with 1g of weed.");
    updateUI();
  };

  smokeBongBtn.onclick = () => {
    if (bongWeed < 0.1) {
      showMessage("The bong is empty! Fill it first.");
      return;
    }
    bongWeed = 0;
    playerState.mode = "smokingBong";
    updateUI();
    showMessage("You smoke the bong. Eyes go red...");
    startSmokeEffect();
  };

  // Laptop UI logic
  openLaptopBtn.onclick = () => {
    if (playerState.mode !== "normal") return;
    laptopUI.style.display = "block";
    rollUI.style.display = "none";
    buyUI.style.display = "none";
    customerOrderUI.style.display = "none";
    populateContacts();
    playerState.mode = "laptop";
    updateUI();
  };

  closeLaptopBtn.onclick = () => {
    laptopUI.style.display = "none";
    playerState.mode = "normal";
    updateUI();
  };

  // Populate dealer and customer lists
  function populateContacts() {
    dealerListEl.innerHTML = "";
    dealers.forEach((d, i) => {
      const li = document.createElement("li");
      const btn = document.createElement("button");
      btn.textContent = `${d.name} (${d.phone}) - $${d.pricePerGram}/g`;
      btn.onclick = () => openBuyUI(d);
      li.appendChild(btn);
      dealerListEl.appendChild(li);
    });

    customerListEl.innerHTML = "";
    customers.forEach((c, i) => {
      const li = document.createElement("li");
      const btn = document.createElement("button");
      btn.textContent = `${c.name} (${c.phone})`;
      btn.onclick = () => openCustomerOrderUI(c);
      li.appendChild(btn);
      customerListEl.appendChild(li);
    });
  }

  // Buying UI logic
  let currentDealer = null;

  function openBuyUI(dealer) {
    laptopUI.style.display = "none";
    buyUI.style.display = "block";
    currentDealer = dealer;
    pricePerGramSpan.textContent = dealer.pricePerGram.toFixed(2);
  }

  buyAmountBtns.forEach((btn) => {
    btn.onclick = () => {
      if (!currentDealer) return;
      const amount = Number(btn.dataset.amount);
      const cost = amount * currentDealer.pricePerGram;
      if (money < cost) {
        showMessage("Not enough money to buy that much weed.");
        return;
      }
      money -= cost;
      weedStock += amount;
      showMessage(`Bought ${amount}g of weed for $${cost.toFixed(2)}.`);
      buyUI.style.display = "none";
      laptopUI.style.display = "block";
      updateUI();
    };
  });

  cancelBuyBtn.onclick = () => {
    buyUI.style.display = "none";
    laptopUI.style.display = "block";
  };

  // Customer order UI logic
  let currentCustomer = null;
  let customerOrderAmount = 0;

  function openCustomerOrderUI(customer) {
    currentCustomer = customer;
    laptopUI.style.display = "none";
    customerOrderUI.style.display = "block";

    // Random order amount 2, 5, or 10g
    const amounts = [2, 5, 10];
    customerOrderAmount = amounts[Math.floor(Math.random() * amounts.length)];
    customerNameSpan.textContent = customer.name;
    customerAmountSpan.textContent = customerOrderAmount;
  }

  acceptOrderBtn.onclick = () => {
    const pricePerGram = 15; // Selling price to customers (fixed)
    const cost = customerOrderAmount;
    if (weedStock < customerOrderAmount) {
      showMessage("Not enough weed stock to fulfill order.");
      return;
    }
    weedStock -= customerOrderAmount;
    money += customerOrderAmount * pricePerGram;
    showMessage(
      `Sold ${customerOrderAmount}g of weed to ${currentCustomer.name} for $${(
        customerOrderAmount * pricePerGram
      ).toFixed(2)}.`
    );
    customerOrderUI.style.display = "none";
    laptopUI.style.display = "block";
    updateUI();
  };

  rejectOrderBtn.onclick = () => {
    showMessage(`Rejected order from ${currentCustomer.name}.`);
    customerOrderUI.style.display = "none";
    laptopUI.style.display = "block";
  };

  closeOrderBtn.onclick = () => {
    customerOrderUI.style.display = "none";
    laptopUI.style.display = "block";
  };

  // Main game loop & animation
  function gameLoop() {
    // Animate rolling hands if rolling
    if (playerState.mode === "rolling") {
      playerState.rollTimer += 1;
      if (playerState.rollTimer > 1000) {
        playerState.rollTimer = 0;
      }
    }
    // Smoke timer countdown
    if (
      playerState.mode === "smokingSpliff" ||
      playerState.mode === "smokingBong"
    ) {
      playerState.smokeTimer -= 16;
      if (playerState.smokeTimer <= 0) {
        playerState.mode = "normal";
      }
    }

    drawPlayer();
    drawSmoke();

    requestAnimationFrame(gameLoop);
  }

  // Init
  updateUI();
  gameLoop();
})();
</script>
</body>
</html>
